<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>MPS Demo - Ad Block Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/foundation.min.css"/>
  <link rel="stylesheet" href="/css/styles.css"/>

  <script type="text/javascript">
    var time = new Date();

    var mpsopts = {'host':'stage.mps.nbcnews.com'};
    var mpscall = {'site':'nbcnews-web'};
    mpscall.path = '/cover';
    mpscall.cat = 'cover';
    mpscall.type = 'cover';
    var mps = mps || {};
    document.write('<scr'+'ipt id="mps-ext-load" src="//'+mpsopts.host+'/fetch/ext/load-'+mpscall.site+'.js"></scr'+'ipt>');

    mps.gptloadCallback = function() {
      console.log('gpt callback');
      mps.insertAd(mps._select('.top-banner'),'topbanner');
      mps.insertAd(mps._select('.right-boxad'),'boxfront1');

    }
  </script>

  <!-- Demo only. -->
  <script>
    var _satellite = [];
  </script>
  <!-- /Demo only. -->

</head>
<body>
<script>
  
  mps._ready(function(){
    var _adLoadCallbackExtend = mps._adloadCallback;
    mps._adloadCallback = function() {
      var args = arguments;
      var result = _adLoadCallbackExtend.apply(this, arguments);
      var _this = args[0];
      if(_this._mps._slot != '_oop') {
        document.getElementById('results').innerHTML += '<li>MPS <strong>' + _this._mps._slot + '</strong> ad code was loaded in <strong>' + _this._mps._elapsed + ' milliseconds</strong>.</li>';
      }
      return result;
    };

  });
</script>

<nav class="top-bar" data-topbar role="navigation">
  <ul class="title-area">
    <li class="name">
      <h1><a href="#">Ad Block Test</a></h1>
    </li>
  </ul>
  <section class="top-bar-section">
    <ul class="right">
      <li><a href="/">Demo</a></li>
      <li><a href="/timing">Timing</a></li>
      <li class="active"><a href="/ad-block">Ad Block</a></li>
    </ul>
  </section>
</nav>

<div class="large-12 content m0auto center">
  <div class="top-banner mt20 top-ad"></div>
</div>

<div class="large-12 content m0auto">

  <div class="large-4 mt40 right">
    <div class="right-boxad panel p20 right"></div>
  </div>

  <div class="large-8">

    <div class="panel mt20"><ul id="results"></ul></div>

    <h1 class="mt20">MPS Demo</h1>

    <div id="ad-blocker">No data.</div>

  </div>

</div>

<footer>
  <div class="large-12 content m0auto">
    <hr />
    <p class="secondary">&copy; 2015, MPS.</p>
  </div>
  <script>typeof(mps.writeFooter)=='function' && mps.writeFooter();</script>
</footer>

<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>

<script>
  // Adblock detection with external file.
  var adBlockEnabled = true;
  // MPS Adblock.
  mps._ready(function() {

    mps._adBlock = function() {

      var msg = '<div class="success alert-box">Ad blocker disabled, you should see ads.</div>';

      if(adBlockEnabled || googletag.cmd.push.length === 0) {
        // Omniture ad blocking variables.
        //_satellite.setVar('ad blocker enabled', 'ads blocked');
        //_satellite.track('ad blocker enabled');
        if(adBlockEnabled) {
          msg = '<div class="alert alert-box">Ad Block or file name ad blocker enabled, no ads should appear.</div>';
          debugmode.log && console.log('[mps._adBlock: Ad Block or file name ad blocker is enabled.');
        } else {
          msg = '<div class="alert alert-box">Ghostery or script blocking is enabled, no ads should appear.</div>';
          debugmode.log && console.log('[mps._adBlock: Ghostery or script blocking ad blocker is enabled.');
        }
      }

      document.getElementById('ad-blocker').innerHTML = msg;

    };

    // Ad blockers will block this file.
    var ads = document.createElement('script');
    ads.src = '/js/ads.js';
    ads.type = 'text/javascript';
    ads.onload = 'test()',
    document.getElementsByTagName('head')[0].appendChild(ads);
    
    // mps._adBlock() is called from an external file to prevent async issues.
    var adBlockInit = document.createElement('script');
    adBlockInit.src = '/js/mps-adblockInit.js';
    adBlockInit.type = 'text/javascript';
    document.getElementsByTagName('head')[0].appendChild(adBlockInit);

  });
  
  // Other ideas - AJAX loading detection method.
  /*$.ajax({
    url: 'http://www.googletagservices.com/tag/js/gpt.js',
    type: 'GET',
    dataType: 'javascript',
    success: function(d) {
      console.log('success');

    },
    error: function(d) {
      console.log('error', d, '/error');
      if(d.statusText != 'error') {
        alert('ghostery enabled');
      }
    }
  });*/

  /*$.get('http://www.googletagservices.com/tag/js/gpt.js')
    .done(function(d) {
      alert('done!');
    }).error(function(d) {
      alert('error!');
    });*/

</script>

</body>
</html>